title: Standard - SSH Authorized Keys File Manipulation
id: d2e3f4a5-b6c7-4d8e-9f0a-1b2c3d4e5f6a
status: experimental
description: |
    공격자가 지속성 확보를 위해 authorized_keys 파일에 공개키를 주입하거나, 
    기존 내용을 변조/삭제하는 행위를 탐지합니다.
logsource:
  product: linux
  category: honeypot
  service: cowrie
detection:
  # 탐지: authorized_keys에 대한 쓰기/삽입/변조 행위 (추측성 조회 제외)
  selection_write:
    - input|re: 'echo\s+.+?\s*>>\s*~?/.ssh/authorized_keys'
    - input|re: 'cat\s+\S+\s*>>\s*~?/.ssh/authorized_keys'
    - input|re: 'sed\s+-i\s+.*~?/.ssh/authorized_keys'
    - input|re: 'install\s+-m\s+\d+\s+\S+\s+~?/.ssh/authorized_keys'
  # ignore read-only accesses like 'cat ~/.ssh/authorized_keys' or 'ls -la ~/.ssh'
  selection_read:
    - input|re: 'cat\s+~?/.ssh/authorized_keys$'
    - input|re: 'ls\s+-l.*~?/.ssh/authorized_keys'
  condition: selection_write and not selection_read
level: medium
tags:
    - attack.persistence
    - attack.t1098.004